<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>Juego en Progreso</title>
  <style>
        canvas {
            border: 2px solid black;
            display: block;
            margin: 20px auto;
            background-color: rgb(179, 231, 181);
        }


        body{
            margin: 0;
            padding: 0;
            background-color: rgb(243, 243, 224);
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }

        .info{
            background-color: rgb(179, 231, 181);
            width: 25%;
            height: 450px;
            margin-left: 20px;
            border-style: double;
            border-color: rgb(8, 8, 8);
            margin-right: 20px;
        }

        .game{
            width: 45%;
        }

        .content{
            display: flex;
            flex-direction: row;
        }

        .options{
            text-align: center;
        }

        .options > button{
            color: rgb(179, 231, 181);
            background-color: black;
            padding: 18px;
            margin: 5px;
        }

        button{
            background-color: rgb(245, 117, 117);
            padding: 15px;
            border-radius: 10px;
        }

        .titulo{
            text-align: center;
        }

        .data{
            margin-top: 25px;
            margin-bottom: 45px;
            margin-left: 15px;
        }

        h2{
            text-align: center;
        }

        h1{
            color: blue;
            font-style: italic;
        }

        .speak{
            text-align: center;
            border-style: double;
            border-color: rgb(8, 8, 8);
            background-color: black;
            color: rgb(179, 231, 181);
            margin-bottom: 15px;
        }

        .control{
            margin-left: 35px;
            text-align: center;
        }

        .control > div > button{
            margin: 10px;
        }

    </style>
</head>
<body>

<div class="titulo">
  <h1>Juego en Progreso</h1>
  <p th:text="'Bienvenido, ' + ${user} + '! Actualmente estás en el Maze: ' + ${mazeName}"></p>
</div>

<div class="content">

  <div class="info">

    <h2>INFORMATION</h2>

    <div class="data">

      <p>Room:</p>
      <p>Time:</p>
      <p>Coins:</p>
      <p>Keys A:</p>
      <p>Keys B:</p>

    </div>

    <div class="speak">
      <p>CUIDADO: MONEDAS INSUFUCUENTES!</p>
    </div>

    <div class="options">
      <button type="button" id="restart">RESTART</button>
      <button type="button" id="exit">EXIT</button>
    </div>

  </div>

  <div class="game">
    <canvas id="gameCanvas" width="550" height="450"></canvas>
  </div>



  <div class="control">

    <div>
      <button type="button" id="up">UP</button>
    </div>
    <div>
      <button type="button" id="left">LEFT</button>
      <button type="button" id="right">RIGHT</button>
    </div>
    <div>
      <button type="button" id="down">DOWN</button>
    </div>
  </div>

</div>


<script>

    async function loadRoomData() {
        try {
            const response = await fetch('/room');
            if (!response.ok) {
                console.error("No se pudo cargar la habitación");
                return;
            }

            const roomData = await response.json();
            drawRoom(roomData);
        } catch (error) {
            console.error("Error al cargar los datos de la habitación:", error);
        }
    }

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    function drawRoom(roomData) {

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, 40, 550);
        ctx.fillRect(0, 0, 550, 40);
        ctx.fillRect(510, 0, 40, 550);
        ctx.fillRect(0, 410, 550, 40);

        roomData.doors.forEach(door => {
            ctx.fillStyle = door.stateDoor ? "#008000" : "#ff0000";
            switch (door.position) {
                case "NORTH":
                    ctx.fillRect(225, 40, 120, 15);
                    break;
                case "SOUTH":
                    ctx.fillRect(225, 395, 120, 15);
                    break;
                case "EAST":
                    ctx.fillRect(495, 165, 15, 120);
                    break;
                case "WEST":
                    ctx.fillRect(40, 165, 15, 120);
                    break;
            }
        });

    }

    window.onload = loadRoomData;

    </script>
</body>
</html>